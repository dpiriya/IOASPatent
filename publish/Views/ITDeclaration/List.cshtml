
@model IOAS.Models.EmpITDeductionModel
@{
    ViewBag.Title = "IT Declaration";
    ViewBag.Subtitle = "IT Declaration";
    Layout = "~/Views/Shared/_LayoutFluid.cshtml";
}
@using (Html.BeginForm("List", "ITDeclaration", FormMethod.Post, new { @class = "form-horizontal", @id = "itDeclaration", @name = "itDeclaration", role = "form" }))
{
    @Html.AntiForgeryToken()


    if (!String.IsNullOrEmpty(ViewBag.Errors))
    {
        @:<script type="text/javascript">$.alert({title:'Validation', content:'@ViewBag.Errors'})</script>
    }
    if (!String.IsNullOrEmpty(ViewBag.Message))
    {
        @:<script type="text/javascript">$.alert({title:'Message', content:'@ViewBag.Message'})</script>
    }

    <div class="wrapper">
        <div class="row hd-tt-bg ">
            <div class="col-md-12">
                <h4><b>Financial Year @Model.FinPeriod</b></h4>
            </div>
        </div>
        <div class="row">
            <div class="white-bg ad-navbar">
                <div class="col-md-1 ds-spl-bg">
                    <div class="ds-tt">
                        <span>Paybillno</span>
                        <h4>691829271</h4>
                    </div>
                </div>

                <div class="col-md-1 ds-spl-bg">
                    <div class="ds-tt">
                        <span>Emp No</span>
                        @Html.DropDownListFor(M => M.EmpInfo.EmployeeID, new SelectList(ViewBag.EmpList, "EmployeeId", "EmployeeId"), "Select", new { @class = "form-control", @required = "required", onchange = "this.form.submit();" })
                    </div>
                </div>

                <div class="col-md-3 ds-spl-bg">
                    <div class="ds-tt">
                        <span>Name</span>
                        <h4>@Model.EmpInfo.EmployeeName</h4>
                    </div>
                </div>



                <div class="col-md-1 ds-spl-bg">
                    <div class="ds-tt">
                        <span>Designation</span>
                        <h4>@Model.EmpInfo.Designation</h4>
                    </div>
                </div>

                <div class="col-md-2 ds-spl-bg">
                    <div class="ds-tt">
                        <span>Department</span>
                        <h4>@Model.EmpInfo.DesignationCode</h4>
                    </div>
                </div>


                <div class="col-md-1 ds-spl-bg">
                    <div class="ds-tt">
                        <span>Pay As</span>
                        <h4>Salary</h4>
                    </div>
                </div>

                <div class="col-md-2 ds-spl-bg">
                    <div class="ds-tt">
                        <span>Pan Number</span>
                        @Html.HiddenFor(model => model.EmpInfo.EmployeeID)
                        <h4>@Model.EmpInfo.EmployeeID</h4>
                    </div>
                </div>

                <div class="col-md-1 ds-spl-bg">
                    <div class="ds-tt">
                        <span>Gender</span>
                        <h4>Male</h4>
                    </div>
                </div>


            </div>
        </div>

        <div class="row hd-tt-bg hd-tt-bg-adj">
            <div class="col-md-12">
                <ul class="nav nav-pills custom-nav-pills">
                    <li class="active" id="picDel"><a href="javascript:void(0)" class="ml-null brd-rd-md">Deductions</a></li>
                    <li id="allOca"><a href="javascript:void(0)" class="brd-rd-md">Exemptions - Section 10</a></li>
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="page-wrapper">
                <div class="col-md-12 mt30">
                    <div id="tab-01" style="display: block;">
                        <div class="row">
                            <div class="col-md-12">
                                <ul class="nav nav-pills custom-nav-pills">
                                    <li class="tablinks active" id="IT80C">
                                        <a href="javascript:void(0)" onclick="switchTabs(event,'tab-80c', 'IT80C')" class="tablinks ml-null brd-rd-md">Section 80C</a>
                                        @*<button class="tablinks ml-null brd-rd-md" onclick="switchTabs(event,'IT80C')">Section 80C</button>*@
                                    </li>
                                    <li class="tablinks" id="IT80D">
                                        <a href="javascript:void(0)" onclick="switchTabs(event,'tab-80d', 'IT80D')" class="brd-rd-md">Section 80D</a>
                                        @*<button class="tablinks ml-null brd-rd-md" onclick="switchTabs(event,'IT80D')">Section 80D</button>*@
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div id="tab-80c" class="tabcontent" style="display: block;">
                            <div class="col-md-6">
                                <div class="bl-lg-panel-box pb-null">
                                    <div class="cmn-panel-box">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-group custom-form-group">
                                                            <label><b>Section 80C, 80CCC</b></label>
                                                        </div>
                                                    </div>

                                                    <div class="col-md-6">
                                                        <div class="form-group custom-form-group text-right">
                                                            <label><b>Max Limit: Rs.1,50,000</b></label>
                                                        </div>
                                                    </div>

                                                </div>
                                                @Html.Partial("_EightyCCPartial")
                                            </div>
                                        </div>

                                    </div>

                                </div>


                            </div>

                        </div>
                        <div id="tab-80d" class="tabcontent" style="display: none;">
                            <div class="col-md-6">
                                <div class="bl-lg-panel-box pb-null">
                                    <div class="cmn-panel-box">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-group custom-form-group">
                                                            <label><b>Section 80CCD</b></label>
                                                        </div>
                                                    </div>
                                                </div>
                                                @Html.Partial("_EightyDDPartial")
                                            </div>
                                        </div>

                                    </div>

                                </div>


                            </div>
                        </div>

                        @*<div class="col-md-6">

                                <div class="bl-lg-panel-box pb-null">
                                    <div id="tab-80C" style="display: block;">
                                    </div>
                                    <div class="cmn-panel-box">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-group custom-form-group">
                                                            <label><b>Section 80C, 80CCC, 80CCD</b></label>
                                                        </div>
                                                    </div>

                                                    <div class="col-md-6">
                                                        <div class="form-group custom-form-group text-right">
                                                            <label><b>Max Limit: Rs.1,50,000</b></label>
                                                        </div>
                                                    </div>

                                                </div>

                                                @Html.Partial("_EightyCCPartial")

                                            </div>
                                        </div>

                                    </div>

                                </div>


                            </div>*@

                        <div class="col-md-6">
                            @Html.Partial("_SOPPartial")
                            @Html.Partial("_OtherIncomePartial")
                        </div>
                    </div>

                </div>
            </div>
        </div>
        @Html.Partial("_ITExemptionPartial")

        <div class="row">
            <div class="col-md-12 mb-lg text-center">
                @*<a href="javascript:void(0);" class="btn btn-primary" type="submit">Save as Draft</a>*@
                <button id="btnSubmit" type="submit" class="btn btn-default" value="Submit">Save as Draft</button>
            </div>
        </div>


    </div>

    <div id="myModal" class="modal fade modal-pr-vw" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <div class="row hd-tt-bg">
                        <div class="col-md-12">
                            <h4><b>Pay Change : </b></h4>
                        </div>
                    </div>


                </div>
                <div class="modal-body">




                    <div class="row">
                        <div class="page-wrapper">

                            <div class="custom-md-bg">

                                <div class="row">

                                    <div class="col-md-6">
                                        <h4>Previous Amount</h4>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="pr-amt-dts">
                                                    <h4>Salary Head: <b>HRA</b></h4>
                                                    <h4>Amount: <b>12123</b></h4>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <h4>Changed Amount</h4>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="pr-amt-dts gray-bg">
                                                    <h4>Salary Head: <b>HRA</b></h4>
                                                    <h4>Amount: <b>12123</b></h4>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>

                            </div>



                        </div>

                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>

        </div>
    </div>


}



<script type="text/javascript">
    //Helper function that gets a count of all the rows <TR> in a table body <TBODY>
    $.fn.rowCount = function() {
        return $('tr', $(this).find('tbody')).length;
    };

    function switchTabs(evt, tabName, tabButtonId) {
        var i, tabcontent, tablinks;
        var result = validate();
        if(result.isValid === true) {
          tablinks = document.getElementsByClassName("tablinks");
          for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
          }
          tabcontent = document.getElementsByClassName("tabcontent");
          for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
          }
          document.getElementById(tabName).style.display = "block";
          evt.currentTarget.className += " active";
          document.getElementById(tabButtonId).className += " active";
        } else {
            alertBox('Warning', result.message);
            result.elem.focus();
        }

    }

    $("#btnSubmit").on('click', function() {
         var msg = $('#errorMsg').val();
        if (msg) {
            alertBox('Validation', msg);
        }
    });

    var rowCount = $('#table80c').rowCount();


    function alertBox(title, message) {
        $.alert({
            title: title || 'Alert!',
            content: message || ''
        });
    }

    function validate() {
        var isValid = true;
        var count = $("[id^=ItList_]").length;
        var controls = $("[id^=ItList_]");
        var amount = 0;
        var maxLimit = 0; 
        var msg = '';
        var Particulars = '';
        var control;
        for(var i=0;i<count;i++){
	        console.log(controls[i].type);
	        if (controls[i].type === 'text' && controls[i].id.indexOf('Amount') > -1) {
		        console.log(controls[i].id +' : '+ $('#'+controls[i].id).val());
                amount = $('#'+controls[i].id).val();
	        }
	        if (controls[i].type === 'hidden' && controls[i].id.indexOf('MaxLimit') > -1) {
		        console.log(controls[i].id +' : '+ $('#'+controls[i].id).val());
                maxLimit = $('#'+controls[i].id).val();
	        }
    	    if (controls[i].type === 'hidden' && controls[i].id.indexOf('Particulars') > -1) {
		        console.log(controls[i].id +' : '+ $('#'+controls[i].id).val());
                Particulars = $('#'+controls[i].id).val();
	        }
            if (parseFloat(maxLimit) > 0 && parseFloat(amount) > parseFloat(maxLimit)) {
                isValid = false;
                msg = Particulars + " amount exceeds the maxmimum limit : " +amount + " -- " +maxLimit;
                control = $('#'+controls[i].id);
                break;
            }
        }
        var result = {
            isValid: isValid,
            message: msg,
            elem: control
        }
        return result;

    }

    function SubmitForm() {
        //Form post
        document.getElementById("itDeclaration").submit();
    }

    $(document).ready(function () {
        var firstpage = 1
        var lastpage = 'Model.TotalPages';
        var currentPage = $('#currentPage').text();

        if (parseInt(currentPage, 10) === parseInt(lastpage, 10)) {
            $('#lastPage').addClass('disabled');
            $('#nextPage').addClass('disabled');
        }
        else if (parseInt(currentPage, 10) === parseInt(firstpage, 10)) {
            $('#firstPage').addClass('disabled');
            $('#previousPage').addClass('disabled');
        }
        $('a[name="pageButton"]').click(function () {
            var pageNo = 1;
            if ($(this).text() === 'First') {
                pageNo = 1;
            }
            else if ($(this).text() === 'Last') {
                pageNo = lastpage;
            }
            else if ($(this).text() === 'Previous') {
                if (parseInt($('#currentPage').text(), 10) > 1) {
                    pageNo = parseInt($('#currentPage').text(), 10) - 1;
                }

            }
            else if ($(this).text() === 'Next') {

                pageNo = parseInt($('#currentPage').text(), 10) + 1;
            }
            else {
                pageNo = $(this).text();
            }
            var papername = $('#txtSearchText').val();
            var model = papername;
            getData(pageNo, model);
        });
    });

    function getData(page, model) {
        var token = $("input[name=__RequestVerificationToken]").val();
        var searchdata = { "__RequestVerificationToken": token, "model": model, "page": page };
        //alert($("input[name=__RequestVerificationToken]").val());

        $.ajax({
            url: 'Url.Action("List", "StaffPayment")',
            type: "POST",
            contentType: "application/x-www-form-urlencoded",
            data: searchdata,
            success: function (data) {
                $("#gridData").html(data);
            }
        });

    }

    function validateRequired() {
        $('#errorMsg').html("");
        var valid = true;
        $("[id^=flowFile]").each(function (index, item) {
            var controlId = $(item).attr("id");
            if ($('#' + controlId).prop('required') && $('#' + controlId).val() === "") {
                $('#errorMsg').html("Please upload all required documents.");
                valid = false;
                return valid;
            }

        });
        return valid;
    }

    function clearUploadText() {
        $("[id^=flowFile]").each(function (index, item) {
            var controlId = $(item).attr("id");
            $('#' + controlId).val("");
        });
    }


    $("input[name='adaccess']:checkbox").click(function () {
        if ($(this).attr("value") == "adaccess") {
            $("#staffID").css("display", "none");
            $("#staffIDText").css("display", "block");
            $("#dept").css("display", "none");
            $("#deptText").css("display", "block");
            $("#staffName").css("display", "none");
            $("#staffNameText").css("display", "block");
            $("#desID").css("display", "none");
            $("#desIDText").css("display", "block");
            $("#genID").css("display", "none");
            $("#genIDText").css("display", "block");
        }

    });

    $(function () {
        $('[data-toggle="tooltip"]').tooltip()
    });

    function modRec() {
        var e = document.getElementById("modRec");
        var strcomType = e.options[e.selectedIndex].value;
        if (strcomType == "0") {
            document.getElementById("cheQue").style.display = "block";
            document.getElementById("banTra").style.display = "none";
            document.getElementById("dd").style.display = "none";
        }
        else if (strcomType == "1") {
            document.getElementById("cheQue").style.display = "none";
            document.getElementById("banTra").style.display = "block";
            document.getElementById("dd").style.display = "none";
        }
        else if (strcomType == "2") {
            document.getElementById("cheQue").style.display = "none";
            document.getElementById("banTra").style.display = "none";
            document.getElementById("dd").style.display = "block";
        }

        console.log(strcomType);
    };

    $("#picDel").on("click", function () {
        $("#tab-01").css("display", "block");
        $("#tab-02").css("display", "none");
        $("#tab-03").css("display", "none");
        $("#tab-04").css("display", "none");
        $("#picDel").addClass('active');
        $("#allOca").removeClass('active');
        $("#modEof").removeClass('active');
        $("#modEof1").removeClass('active');
    });

    $("#allOca").on("click", function () {
        $("#tab-01").css("display", "none");
        $("#tab-02").css("display", "block");
        $("#tab-03").css("display", "none");
        $("#tab-04").css("display", "none");
        $("#picDel").removeClass('active');
        $("#allOca").addClass('active');
        $("#modEof").removeClass('active');
        $("#modEof1").removeClass('active');
    });

    $("#modEof").on("click", function () {
        $("#tab-01").css("display", "none");
        $("#tab-02").css("display", "none");
        $("#tab-03").css("display", "block");
        $("#tab-04").css("display", "none");
        $("#picDel").removeClass('active');
        $("#allOca").removeClass('active');
        $("#modEof").addClass('active');
        $("#modEof1").removeClass('active');
    });

    $("#modEof1").on("click", function () {
        $("#tab-01").css("display", "none");
        $("#tab-02").css("display", "none");
        $("#tab-03").css("display", "none");
        $("#tab-04").css("display", "block");
        $("#picDel").removeClass('active');
        $("#allOca").removeClass('active');
        $("#modEof").removeClass('active');
        $("#modEof1").addClass('active');
    });

</script>
